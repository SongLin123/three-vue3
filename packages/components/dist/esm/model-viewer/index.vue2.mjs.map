{"version":3,"file":"index.vue2.mjs","sources":["../../../src/model-viewer/index.vue"],"sourcesContent":["<template>\r\n    <div class=\"render\">\r\n    </div>\r\n</template>\r\n<script setup lang=\"ts\">\nimport { mergeDefaults as __MACROS_mergeDefaults } from \"vue\";\r\nimport * as THREE from \"three\";\r\nimport { createScene, createFloor, createGui } from \"../hooks\";\r\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader.js\";\r\nimport { defineComponent, getCurrentInstance, h, onMounted, onUnmounted, ref } from \"vue\";\r\nimport { GUI } from \"dat.gui\";\r\n\r\n\r\n\r\n// const renderDom = ref<HTMLElement | null>(null)\r\ndefineProps(__MACROS_mergeDefaults({\r\n    gltfUrl: {\r\n        type: String,\r\n        default: ''\r\n    }\r\n}, {  }))\r\n\r\nconst { scene, camera, renderer, controls, setAutoCameraLookAt } = createScene();\r\n\r\ncreateFloor(scene)\r\n// 加载背景\r\nscene.background = new THREE.Color('grey')\r\n\r\nlet model: THREE.Group\r\n\r\nconst setModel = (gltfUrl?: string) => {\r\n    // 加载模型\r\n    if (gltfUrl) {\r\n\r\n        if (model) {\r\n            scene.remove(model)\r\n        }\r\n        const loader = new GLTFLoader();\r\n        loader.load(gltfUrl, (gltf) => {\r\n            model = gltf.scene\r\n\r\n            const box = new THREE.Box3().setFromObject(model);\r\n            const boxSizeX = box.getSize(new THREE.Vector3()).x\r\n            if (boxSizeX > 100) {\r\n                const scale = 1 / (boxSizeX / 100)\r\n                model.scale.set(scale, scale, scale)\r\n            }\r\n\r\n            setAutoCameraLookAt(model)\r\n            scene.add(model);\r\n        })\r\n\r\n    }\r\n}\r\n\r\n\r\n\r\nconst light2 = new THREE.SpotLight(0xffffff);\r\nlight2.position.set(0, 20, 10);\r\n\r\nconst light2Helper = new THREE.SpotLightHelper(light2, 'red');\r\nlight2Helper.visible = false;\r\nscene.add(light2Helper);\r\nscene.add(light2);\r\nconst light3 = new THREE.SpotLight(0xffffff, 1, 100);\r\nlight3.position.set(0, 20, -10);\r\n\r\nconst light3Helper = new THREE.SpotLightHelper(light3, 'blue');\r\nlight3Helper.visible = false;\r\nscene.add(light3Helper);\r\nscene.add(light3);\r\n\r\n\r\n// 调整gui位置\r\nconst gui = new GUI({ width: 300 });\r\nonMounted(() => {\r\n\r\n    const root = getCurrentInstance()?.ctx.$el! as HTMLElement\r\n    const rect = root.getBoundingClientRect()\r\n    gui.domElement.style.position = 'absolute';\r\n\r\n    gui.domElement.style.top = rect.top + 'px';\r\n    gui.domElement.style.left = rect.right - 300 + 'px';\r\n\r\n\r\n})\r\n\r\n\r\ncreateGui(gui, {\r\n    target: light2,\r\n    name: 'light2',\r\n    field: {\r\n        'intensity': [0, 2, 0.01],\r\n        'position': {\r\n            x: [-100, 100, 0.1],\r\n            y: [-100, 100, 0.1],\r\n            z: [-100, 100, 0.1],\r\n        },\r\n        'angle': [0, Math.PI / 2, 0.01],\r\n        'penumbra': [0, 1, 0.01],\r\n        'decay': [0, 2, 0.01],\r\n        'distance': [0, 100, 0.01],\r\n        'castShadow': [],\r\n        'visible': [],\r\n    }\r\n})\r\ncreateGui(gui, {\r\n    target: light3,\r\n    name: 'light3',\r\n    field: {\r\n        'intensity': [0, 2, 0.01],\r\n        'position': {\r\n            x: [-100, 100, 0.1],\r\n            y: [-100, 100, 0.1],\r\n            z: [-100, 100, 0.1],\r\n        },\r\n        'angle': [0, Math.PI / 2, 0.01],\r\n        'penumbra': [0, 1, 0.01],\r\n        'decay': [0, 2, 0.01],\r\n        'distance': [0, 100, 0.01],\r\n        'castShadow': [],\r\n        'visible': [],\r\n    }\r\n})\r\ncreateGui(gui, {\r\n    target: light2Helper,\r\n    name: 'light2Helper',\r\n    field: {\r\n        'visible': [],\r\n    }\r\n})\r\ncreateGui(gui, {\r\n    target: light3Helper,\r\n    name: 'light3Helper',\r\n    field: {\r\n        'visible': [],\r\n    }\r\n})\r\n\r\n\r\n\r\n\r\nsetModel(__props.gltfUrl)\r\ndefineExpose({\r\n    scene,\r\n    camera,\r\n    renderer,\r\n    controls,\r\n    setModel\r\n})\r\n\r\n\r\n\r\n</script>\r\n<style>\r\n.render {\r\n    width: 100%;\r\n    height: 100%;\r\n    flex: 1;\r\n}\r\n</style>"],"names":["THREE.Color","THREE.Box3","THREE.Vector3","THREE.SpotLight","THREE.SpotLightHelper","GUI"],"mappings":"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"}